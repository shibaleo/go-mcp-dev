---
title: MCPist 要件仕様サブコア定義
aliases:
  - dtl-req-cor
  - requirement-sub-core
tags:
  - MCPist
  - architecture
  - sub-core
  - DTL
document-type: detail
document-class: DTL
created: 2026-01-14T00:00:00+09:00
updated: 2026-01-14T00:00:00+09:00
---
# MCPist 要件仕様サブコア定義

## ドキュメント管理情報

| 項目 | 値 |
|------|-----|
| Status | `current` |
| Version | v1.0 (DAY5) |
| Note | spec-req.mdからサブコア要件を抽出 |

---

## 概要

本ドキュメントは、spec-req.md（要件仕様書）の中で、コア機能（COR-xxx）を前提とした場合に複数の独立した根拠を持つ要件を「サブコア」として定義する。

**評価基準:**
- コア機能を前提とした場合に、2つ以上の独立した根拠を持つ
- そのコア機能が変わらない限り、変更されない

---

## サブコア要件

### REQ-COR-001: シングルユーザー・マルチアカウント設計

**前提コア:**
- COR-003 (サーバー側認証設計)
- COR-004 (決定論的オーケストレーター)

**独立した根拠（2つ）:**

| # | 根拠 | 由来コア |
|---|------|----------|
| 1 | サーバー側でトークン管理 → 1ユーザーが複数の外部サービスアカウントを管理可能 | COR-003 |
| 2 | 決定論的設計 → マルチテナント時の複雑な権限判断を回避 | COR-004 |

**定義:**
```
1インスタンス = 1ユーザー = N外部アカウント
├─ Google Account A, B
├─ Microsoft Account A
└─ Notion Workspace A, B, C
```

**spec-req.mdでの位置:** 2.1 コア設計原則

---

### REQ-COR-002: スコープ外事項の明確化

**前提コア:**
- COR-004 (決定論的オーケストレーター)
- COR-001 (メタツール方式)

**独立した根拠（2つ）:**

| # | 根拠 | 由来コア |
|---|------|----------|
| 1 | 決定論的処理に徹する → 要約・統合・再構成は非決定論的でありスコープ外 | COR-004 |
| 2 | メタツール方式 → ツール選択判断はLLM側に委ねる | COR-001 |

**定義:**
```
スコープ外:
├─ 非決定論的処理（要約、統合、再構成、ツール選択判断）
├─ マルチテナント対応
├─ MCP仕様の拡張
└─ 通知制御、ログ表示（クライアント側責任）
```

**spec-req.mdでの位置:** 2.2 スコープ外事項

---

### REQ-COR-003: メタツールによるコンテキスト制御

**前提コア:**
- COR-001 (メタツール方式)
- COR-008 (TOON形式)

**独立した根拠（2つ）:**

| # | 根拠 | 由来コア |
|---|------|----------|
| 1 | メタツール方式 → 初期化時のツール公開を最小化 | COR-001 |
| 2 | TOON形式 → レスポンス形式の最適化でコンテキスト節約 | COR-008 |

**定義:**
```
コンテキスト制御機能（5機能）:
├─ メタツール3個のみ初期公開
├─ スキーマ動的取得
├─ 権限外ツール非公開
├─ TOON形式レスポンス
└─ Context Rot防止
```

**spec-req.mdでの位置:** 3.1 カテゴリ別機能数（コンテキスト制御: 5）

---

### REQ-COR-004: 外部サービス連携のモジュール化

**前提コア:**
- COR-009 (モジュールCLI実装)
- COR-007 (Go採用)

**独立した根拠（2つ）:**

| # | 根拠 | 由来コア |
|---|------|----------|
| 1 | モジュールCLI実装 → 各外部サービス連携は独立モジュール | COR-009 |
| 2 | Go採用 → モジュールもGoで実装、統一的なビルド・テスト | COR-007 |

**定義:**
```
外部サービス連携（9機能）:
├─ 各サービスをGoモジュールとして実装
├─ CLI実行可能な独立バイナリ
├─ モジュールレジストリからライブラリ呼び出し
└─ 人間/LLM実行の等価性保証
```

**spec-req.mdでの位置:** 3.1 カテゴリ別機能数（外部サービス連携: 9）

---

### REQ-COR-005: 認証・認可の一元管理

**前提コア:**
- COR-003 (サーバー側認証設計)
- COR-005 (RLS非依存認可)

**独立した根拠（2つ）:**

| # | 根拠 | 由来コア |
|---|------|----------|
| 1 | サーバー側認証 → Token BrokerでJWT検証・トークン取得を一元化 | COR-003 |
| 2 | RLS非依存 → アプリケーション層での認可でポータビリティ確保 | COR-005 |

**定義:**
```
アカウント・認証管理（6機能）:
├─ マルチアカウント対応
├─ トークン暗号化（AES-256-GCM）
├─ JWT検証
├─ Token Broker
├─ Edge Function内user_idフィルタ
└─ RLSは補助層
```

**spec-req.mdでの位置:** 4.1 カテゴリ別機能数（アカウント・認証管理: 6）

---

## 非サブコア要件（単一根拠）

以下は重要な要件だが、コア機能からの導出が単一であるためサブコアとしない。

| 要件 | 根拠数 | 理由 |
|------|--------|------|
| 記録・トレース（5機能） | 1 | COR-004（決定論的）からの単一導出 |
| 並列・バックグラウンド実行（6機能） | 1 | COR-007（Go）からの単一導出 |
| 管理UI（6機能） | 1 | COR-006（Next.js）からの単一導出 |
| パフォーマンス目標 | 1 | COR-101（$0制約）からの単一導出 |

---

## サブコアマトリックス

| ID | サブコア要件 | 前提コア | 根拠数 |
|----|--------------|----------|--------|
| REQ-COR-001 | シングルユーザー・マルチアカウント | COR-003, COR-004 | 2 |
| REQ-COR-002 | スコープ外事項の明確化 | COR-004, COR-001 | 2 |
| REQ-COR-003 | メタツールによるコンテキスト制御 | COR-001, COR-008 | 2 |
| REQ-COR-004 | 外部サービス連携のモジュール化 | COR-009, COR-007 | 2 |
| REQ-COR-005 | 認証・認可の一元管理 | COR-003, COR-005 | 2 |

---

## 関連ドキュメント

- [dtl-core.md](dtl-core.md) - コア機能定義
- [spec-req.md](../DAY4/spec-req.md) - 要件仕様書
