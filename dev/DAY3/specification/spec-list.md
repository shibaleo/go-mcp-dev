---
title: MCPist 仕様トレーサビリティ（spec-list）
aliases:
  - spec-list
  - MCPist-traceability
tags:
  - MCPist
  - specification
  - traceability
document-type:
  - specification
document-class: specification
created: 2026-01-12T00:00:00+09:00
updated: 2026-01-14T00:00:00+09:00
---
# MCPist 仕様トレーサビリティ

本ドキュメントは、仕様書ナビゲーションと要件トレーサビリティを提供します。

---

## ドキュメント管理情報

| 項目 | 値 |
|------|-----|
| Status | `current` |
| Version | v1.0 |
| Note | go-mcp-dev版と同一内容 |

---

## 仕様書ナビゲーション

### 仕様書の構成

| ドキュメント | 役割 | 読むタイミング | 行数 |
|-------------|------|--------------|-----|
| [spec-sys.md](spec-sys.md) | システム全体像 | **最初に読む** | ~500行 |
| [spec-dsn.md](spec-dsn.md) | 技術仕様・API設計 | 実装時に参照 | ~460行 |
| [spec-inf.md](spec-inf.md) | インフラ構成・デプロイ | デプロイ時に参照 | ~350行 |
| [spec-ops.md](spec-ops.md) | 運用手順・監視 | 運用開始時に参照 | ~540行 |

**推奨読書順序:** spec-sys.md → spec-dsn.md → spec-inf.md + spec-ops.md

### 各Specのカバー範囲

| Spec | カバー範囲 | 対象読者 |
|------|----------|---------|
| spec-sys.md | システム構成、コンポーネント役割、認証フロー、データフロー | 全員 (新規参加者必読) |
| spec-dsn.md | メタツール設計、データモデル、エラーコード、危険操作フラグ、管理UI | 実装担当者 |
| spec-inf.md | Koyeb/Supabase/Grafana構成、環境変数、コスト試算、デプロイ | DevOps担当者 |
| spec-ops.md | 初回セットアップ、OAuth設定、KPI、監視、Runbook、トラブルシューティング | 運用担当者 |

### コンポーネント別参照マップ

| 知りたいこと | 参照先 |
|------------|--------|
| システム全体像 | [spec-sys.md § 1](spec-sys.md) |
| メタツール設計 | [spec-dsn.md § 2](spec-dsn.md) |
| Token Broker | [spec-sys.md § 2.3](spec-sys.md), [ADR-005](adr/ADR-005-no-rls-dependency.md) |
| Vaultデータ構造 | [spec-dsn.md § 3](spec-dsn.md) |
| 認証・認可 | [spec-sys.md § 4](spec-sys.md), [ADR-005](adr/ADR-005-no-rls-dependency.md) |
| OAuth設定 | [spec-ops.md § 2.3](spec-ops.md) |
| エラーコード | [spec-dsn.md § 4](spec-dsn.md) |
| デプロイ手順 | [spec-inf.md § 3](spec-inf.md) |
| ログ検索 | [spec-ops.md § 3.3](spec-ops.md) |
| 障害対応 | [spec-ops.md § 9](spec-ops.md) |
| 可用性目標 | [spec-ops.md § 1.3](spec-ops.md) |

---

## 要件トレーサビリティ

MCPistは3つのコア設計原則に基づいて構築される:

1. **シングルテナント・シングルユーザー・マルチアカウント** - 個人利用に特化
2. **オーケストレーターであり、エージェントではない** - 判断はLLMに委ねる
3. **決定論的処理に徹する** - 非決定論的処理は行わない

これらの原則から導かれる仕様と、ペルソナ分析から導出された要件の対応関係を以下に示す。

---

## システム構成と要件対応

### MCPサーバー

**役割**: 純粋な計算サーバーとして決定論的処理のみを行う

| 機能 | 説明 | 対応要件 |
|------|------|----------|
| ルーティング | リクエストを適切なモジュールへ振り分け | REQ-043 必要なツールだけをLLMが呼び出す |
| スキーマ動的取得 | メタツール経由でモジュールスキーマを返却 | REQ-039 必要最低限の情報だけがコンテキストに含まれる |
| 認証プロキシ | Token Brokerから取得したトークンで外部API呼び出し | REQ-013 ユーザー操作なしで継続実行できる |
| エラーハンドリング | 統一されたエラー形式で応答 | REQ-052 失敗時は必ず明確に通知される |
| ステートレス設計 | サーバーは状態を持たない | REQ-028 長期間触らなくても再開可能 |
| ユーザーレベルマスク | ユーザーごとに利用可能なツールを制御 | REQ-038 個人用情報は仕事用・開発用と混ざらない |

**やらないこと**（OFS-008: 非決定論的処理に対応）:
- データ永続化（ベクトル化しない）
- 判断・選択（どのツールを呼ぶかはLLM側の責任）
- 非決定論的変換（要約、統合、再構成）
- バックエンドLLM（推論処理はユーザーLLMに委ねる）

---

### 認証の二層構造

MCPistは2つの独立した認証レイヤーを持つ。

#### MCPサーバー認証（OAuth2.1 JWT）

LLMクライアント → MCPサーバー間の認証

| 仕様 | 説明 | 対応要件 |
|------|------|----------|
| JWT発行・検証 | Authサーバーが発行したJWTをMCPサーバーが検証 | REQ-001 個人用アカウントは他アカウントと物理的・論理的に分離 |
| user_accountID抽出 | JWTからユーザー・アカウント情報を取得 | REQ-023 他人のデータ侵害につながる設計は避ける |
| 通信暗号化 | 全接続でTLS 1.3 | REQ-016 外部クラウドへの自動送信を行わない |

#### 外部サービス認証（OAuth2.0など）

MCPサーバー → 外部API間の認証

| 仕様 | 説明 | 対応要件 |
|------|------|----------|
| トークン暗号化保存 | AES-256-GCMでリフレッシュトークンを保存 | REQ-015 業務データは原則ローカルPC内で完結 |
| 自動リフレッシュ | 期限切れ時のトークン自動更新 | REQ-013 ユーザー操作なしで継続実行できる |
| リトライ機構 | Token Broker接続は自動リトライ | REQ-027 障害対応が頻発しないこと |

---

### Token Broker（Vault）

MCPサーバーと外部サービス間の認証を仲介する。

| コンポーネント | 役割 | 対応要件 |
|---------------|------|----------|
| Vault | 外部サービスのOAuthトークンを暗号化保存 | REQ-017 データ保存先・持ち出し範囲を明示的に制御 |
| Edge Function | トークン取得・リフレッシュ処理 | REQ-013 ユーザー操作なしで継続実行できる |
| ユーザープロフィール | ユーザーごとのツール公開設定 | REQ-038 個人用情報は仕事用・開発用と混ざらない |

---

### 管理UI

ユーザーが各外部サービスのOAuthアプリケーションを登録・認可する。

| 機能 | 説明 | 対応要件 |
|------|------|----------|
| 単一エンドポイント | 独自ドメインでMCPサーバーを公開 | REQ-096 MCPサーバーの単一エンドポイント提供 |
| OAuthクライアント登録 | Client ID/Secret登録フォーム | REQ-093 初回セットアップ |
| 認可フロー実行 | redirect → 同意 → callback | REQ-094 一元的管理UIの提供 |
| トークン状態確認 | 各サービスのトークン状態表示 | REQ-094 一元的管理UIの提供 |
| 管理画面認証 | 管理UIへのログイン認証 | REQ-095 管理画面のログイン機能 |

---

## メタツール設計と要件対応

MCPistはContext Rot防止のため、全ツールを`tools/list`で公開しない。

### Context Rot問題への対応

| 従来のMCP | MCPist |
|-----------|--------|
| 全100ツール公開 | メタツール3つのみ公開 |
| LLMが100ツールから選択推論 | 必要なモジュールだけオンデマンド取得 |
| コンテキスト消費大 | コンテキスト節約 |

対応要件:
- REQ-039 必要最低限の情報だけがコンテキストに含まれる
- REQ-040 タスク実行時に不要な情報参照が発生しない

### メタツール一覧

| ツール名 | 説明 | 対応要件 |
|----------|------|----------|
| get_module_schema | モジュールのツール定義を取得 | REQ-039, REQ-043 |
| call | モジュールのツールを単発実行 | REQ-003 タスク完了結果だけを返す |
| batch | 複数ツールを一括実行 | REQ-002, REQ-010, REQ-011, REQ-022 |

### batch仕様

並列実行・タスク実行に関する要件への対応:

| フィールド | 説明 | 対応要件 |
|-----------|------|----------|
| after | 依存タスクID指定 | REQ-002 依存関係のないタスクは並列実行 |
| output | true時のみ結果返却 | REQ-003 タスク完了結果だけを返す |
| 並列実行 | afterなしタスクは並列 | REQ-010, REQ-011, REQ-022 |

---

## モジュールレジストリと要件対応

外部サービスへのアクセスを提供するモジュール群。

| モジュール | 機能 | 対応要件 |
|-----------|------|----------|
| Notion | ページ・データベース操作 | REQ-006 タスク・アイデア・思考が自動で記録 |
| GitHub | リポジトリ・Issue・PR操作 | REQ-006 タスク・アイデア・思考が自動で記録 |
| Jira | Issue/Project操作 | REQ-042 複数UI操作を意識せずタスクが完了 |
| Confluence | Space/Page操作 | REQ-042 複数UI操作を意識せずタスクが完了 |
| Supabase | DB操作・ストレージ | REQ-018 ログ・中間生成物もローカル管理 |
| Google Calendar | 予定の取得・作成 | REQ-008 データを自動取得・整理 |
| Microsoft Todo | タスク管理 | REQ-007 手作業での記録不要 |
| RAG | セマンティック検索 | REQ-004, REQ-005 参照データ限定・Web情報除外 |

---

## インフラ・運用と要件対応

### 推奨構成

| コンポーネント | サービス | 対応要件 |
|---------------|----------|----------|
| MCPサーバー | Koyeb Free Tier | REQ-021 個人裁量の範囲で完結 |
| Authサーバー | Supabase Auth | REQ-034 個人利用を前提として成立 |
| Vault | Supabase Vault | REQ-036 大規模SaaS運用を前提としない |
| ログ収集 | Grafana Cloud Loki | REQ-029, REQ-030, REQ-031 |

### 可観測性

| 仕様 | 説明 | 対応要件 |
|------|------|----------|
| 構造化ログ | JSON形式でのログ出力 | REQ-030 ログが構造化されて保存 |
| ログレベル設計 | DEBUG/INFO/WARN/ERROR | REQ-032 ログが過剰でノイズだらけにならない |
| ヘルスチェック | /health エンドポイント | REQ-026 基本的に放置運用が可能 |
| コールドスタート対策 | 定期ヘルスチェック | REQ-048, REQ-057 待ち時間最小化 |

---

## 安全設計と要件対応

| 仕様 | 説明 | 対応要件 |
|------|------|----------|
| 危険操作フラグ | 破壊的操作にフラグを付与 | REQ-019 対外コミュニケーションは自動実行しない |
| 安全デフォルト | デフォルトが安全側の実装 | REQ-025 デフォルトが安全側の実装 |
| 権限分離 | アカウント別のデータ境界 | REQ-024 権限・データ境界が明確に分離 |

---

## 設計原則と要件対応

### シングルテナント・シングルユーザー・マルチアカウント

| 要件 | 説明 |
|------|------|
| REQ-001 | 個人用アカウントは他アカウントと物理的・論理的に分離 |
| REQ-034 | 個人利用を前提として成立すること |
| REQ-036 | 大規模・商用SaaS運用を前提としないこと |
| REQ-037 | 少人数利用でも破綻しない設計であること |

### オーケストレーターであり、エージェントではない

| 要件 | 説明 |
|------|------|
| REQ-003 | タスク完了結果だけを返す（軽量タスク） |
| REQ-009 | 成果物が利用可能状態で返却 |

### 決定論的処理に徹する

| 要件 | 説明 |
|------|------|
| REQ-002 | 依存関係のないタスクは並列実行される |
| REQ-010 | 軽量タスクは並列処理され待ち時間を最小化 |

---

## 集計

### 要件カバレッジ

| 分類 | 総数 | 仕様対応 | カバー率 |
|------|------|----------|---------|
| 自前実装 | 40 | 33 | 83% |
| 外部規格依存 | 23 | 11 | 48% |
| LLMベンダ依存 | 33 | 0 | 0% |
| **合計** | **96** | **44** | **46%** |

※ LLMベンダ依存はMCPサーバーの仕様対象外（req-ofs.md参照）

### ID体系

| 種別 | フォーマット | 範囲 |
|------|-------------|------|
| 要件 | REQ-xxx | REQ-001〜REQ-096 |
| 機能要件 | FNR-xxx | FNR-001〜FNR-049 |
| 非機能要件 | NFR-xxx | NFR-001〜NFR-037 |
| スコープ外 | OFS-xxx | OFS-001〜OFS-009 |

---

## 関連ドキュメント

### 仕様・設計
- [MCPist仕様書](DAY2/spec-MCPist.md) - システム仕様の詳細

### 要件定義
- [要件一覧](DAY3/requirements/req-list.md) - 全96要件
- [機能要件](DAY3/requirements/req-fnr.md) - 49機能
- [非機能要件](DAY3/requirements/req-nfr.md) - 37機能
- [スコープ外機能](DAY3/requirements/req-ofs.md) - 9カテゴリ
- [要件サマリー](DAY3/requirements/req-summary.md) - 要件の概要
