# MCPサーバー 要件サマリー

本ドキュメントは、MCPサーバーの要件定義ドキュメント群の概要と数的整合性を示す。

---

## ドキュメント構成

| ファイル | ID体系 | 内容 |
|---------|--------|------|
| [req-list.md](req-list.md) | REQ-xxx | 要件一覧（96項目） |
| [req-fnr.md](req-fnr.md) | FNR-xxx | 機能要件（49機能） |
| [req-nfr.md](req-nfr.md) | NFR-xxx | 非機能要件（37機能） |
| [req-ofs.md](req-ofs.md) | OFS-xx | スコープ外機能（29項目） |

---

## 数的整合性

### 要件の分類（req-list.md）

| 分類 | 件数 | 対応先 |
|------|------|--------|
| 自前実装 | 40 | req-fnr.md, req-nfr.md |
| 外部規格依存 | 23 | req-fnr.md, req-nfr.md |
| LLMベンダ依存 | 33 | req-ofs.md |
| **合計** | **96** | - |

### 分類の定義

| 分類 | 説明 | 例 |
|------|------|-----|
| **自前実装** | 自分でコード実装・設計できる | 管理UI, Token Exchanger, MCPサーバー本体, タスク並列実行, ログ設計, 権限分離, Vault |
| **外部規格依存** | 外部サービスのAPI仕様・プロトコルに従う | OAuth 2.0/2.1, 各サービスAPI, MCP仕様, TLS, JWT |
| **LLMベンダ依存** | LLMクライアント・ホストの実装に依存 | MCPクライアント, ツール呼び出し判断, 通知UI, コンテキスト管理, 並列呼び出しサポート |

### 要件ドキュメント別の受け入れ基準カバレッジ

| ドキュメント | 要件数 | 備考 |
|-------------|--------|------|
| req-fnr.md | 39 | 自前実装 + 外部規格依存の一部 |
| req-nfr.md | 24 | 自前実装 + 外部規格依存の一部 |
| req-ofs.md | 33 | LLMベンダ依存 |
| **合計** | **96** | req-list.mdと一致 |

### 検証式

```
自前実装 (40) + 外部規格依存 (23) + LLMベンダ依存 (33) = 96 ✅
req-list.md 合計 = 96 ✅
```

---

## req-fnr.md: 機能要件

MCPサーバーが提供する機能（自前実装 + 外部規格依存）。

### カテゴリ一覧

| カテゴリID | カテゴリ名 | 機能ID範囲 | 機能数 |
|-----------|-----------|-----------|--------|
| FNR-01 | コンテキスト制御 | FNR-001〜FNR-005 | 5 |
| FNR-02 | データアクセス制御 | FNR-006〜FNR-010 | 5 |
| FNR-03 | 外部サービス連携 | FNR-011〜FNR-019 | 9 |
| FNR-04 | RAG・知識検索 | FNR-020〜FNR-024 | 5 |
| FNR-05 | 記録・トレース | FNR-025〜FNR-029 | 5 |
| FNR-06 | ツール設計 | FNR-030〜FNR-037 | 8 |
| FNR-07 | 並列・バックグラウンド実行 | FNR-038〜FNR-043 | 6 |
| FNR-08 | 管理UI | FNR-044〜FNR-049 | 6 |
| **合計** | - | - | **49** |

### 優先度別機能数

| 優先度 | 機能数 | 説明 |
|--------|--------|------|
| P0 | 7 | 必須（コア機能） |
| P1 | 9 | 重要（UX向上） |
| P2 | 11 | 推奨（完成度向上） |
| P3 | 7 | 将来（拡張機能） |
| **合計** | **34** | - |

※ 優先度テーブルには一部機能のみ記載（全49機能中34機能）

---

## req-nfr.md: 非機能要件

MCPサーバーの利用準備、可観測性、安全性に関する要件。

### カテゴリ一覧

| カテゴリID | カテゴリ名 | 機能ID範囲 | 機能数 |
|-----------|-----------|-----------|--------|
| NFR-01 | アカウント・認証管理 | NFR-001〜NFR-006 | 6 |
| NFR-02 | ログ・可観測性 | NFR-007〜NFR-014 | 8 |
| NFR-03 | 安全設計 | NFR-015〜NFR-022 | 8 |
| NFR-04 | パフォーマンス | NFR-023〜NFR-026 | 4 |
| NFR-05 | 運用性 | NFR-027〜NFR-030 | 4 |
| NFR-06 | 拡張性・保守性 | NFR-031〜NFR-034 | 4 |
| NFR-07 | 管理UI認証 | NFR-035〜NFR-037 | 3 |
| **合計** | - | - | **37** |

※ NFR-05, NFR-06は受け入れ基準に直接対応しない運用・設計要件

### 優先度別機能数

| 優先度 | 機能数 | 説明 |
|--------|--------|------|
| P0 | 5 | 必須 |
| P1 | 6 | 重要 |
| P2 | 5 | 推奨 |
| P3 | 2 | 将来 |
| **合計** | **18** | - |

※ 優先度テーブルには一部機能のみ記載（全37機能中18機能）

### 役割の定義

| 役割 | 関心事 | 主な活動 |
|------|--------|----------|
| ユーザー | LLMとの会話体験 | タスク依頼、結果確認 |
| 運用者 | サーバーの維持・管理 | トークン管理、障害対応、コスト管理 |
| 開発者 | コードの変更・拡張 | モジュール追加、バグ修正、テスト |

---

## req-ofs.md: スコープ外機能

MCPサーバーが担当しない機能（LLMクライアント・UI・設計方針に依存）。

### カテゴリ一覧

| カテゴリID | カテゴリ名 | 要件数 |
|-----------|-----------|--------|
| OFS-001 | 通知・UX設計 | 7 |
| OFS-002 | LLM振る舞い制御 | 5 |
| OFS-003 | タスク分解・構造化 | 2 |
| OFS-004 | 開発方針・設計思想 | 10 |
| OFS-005 | 運用・責任境界 | 2 |
| OFS-006 | 主観的成果 | 3 |
| OFS-007 | ユーザー・組織 | - |
| OFS-008 | 非決定論的処理 | - |
| OFS-009 | プロトコル・インフラ | - |
| **受け入れ基準ベース合計** | - | **29** |

※ OFS-007〜OFS-009は受け入れ基準に直接対応しない設計上のスコープ外項目

### スコープ外の判断基準

1. **非決定論的処理**: LLMが必要な処理はMCPサーバー側で行わない
2. **マルチユーザー対応**: 自分以外のユーザーを想定しない
3. **複雑な制御フロー**: LLMとの対話で解決すべき問題
4. **プロトコル拡張**: 既存のMCP仕様を変更・拡張しない
5. **クライアント依存**: UI・通知などクライアント側の責任

---

## 全体サマリー

### 機能数の集計

| ドキュメント | カテゴリ数 | 機能数 |
|-------------|----------|--------|
| req-fnr.md | 8 | 49 |
| req-nfr.md | 7 | 37 |
| **合計** | **15** | **86** |

### 要件の分配

```
要件 96項目
├── 自前実装 (40) + 外部規格依存 (23) = 63項目
│   ├── req-fnr.md: 機能要件（49機能）
│   └── req-nfr.md: 非機能要件（37機能）
└── LLMベンダ依存 (33)
    └── req-ofs.md: スコープ外（29項目 + 設計スコープ外）
```

### ID体系

| 種別 | フォーマット | 範囲 |
|------|-------------|------|
| 要件 | REQ-xxx | REQ-001〜REQ-096 |
| 機能要件 | FNR-xxx | FNR-001〜FNR-049 |
| 非機能要件 | NFR-xxx | NFR-001〜NFR-037 |
| スコープ外 | OFS-xxx | OFS-001〜OFS-009 |

### 設計原則（設計思想）

- 決定論的処理に徹する
- バックエンドLLMを持たない
- データ永続化しない（ベクトル化しない）
- シングルテナント・シングルユーザー・マルチアカウント

---

## 関連ドキュメント

- [要件一覧](req-list.md)
- [機能要件](req-fnr.md)
- [非機能要件](req-nfr.md)
- [スコープ外機能](req-ofs.md)
- [ペルソナサマリー](user-analysis-summary.md)
