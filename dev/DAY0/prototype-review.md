---
title: MCPist プロトタイプレビュー
aliases:
  - prototype-review
  - day0-prototype
tags:
  - MCPist
  - prototype
  - DAY0
document-type: review
document-class: foundation
created: 2026-01-09T00:00:00+09:00
updated: 2026-01-14T00:00:00+09:00
---
# MCPist プロトタイプレビュー

## ドキュメント管理情報

| 項目      | 値                    |
| ------- | -------------------- |
| Status  | `current`            |
| Version | v2.0 (DAY5再構成)       |
| Note    | 関連性でグループ化、改善可能性評価を追加 |

---

## 改善可能性の凡例

| 評価 | 意味 |
|------|------|
| 易 | 実装方針が明確、工数も見積もり可能 |
| 難 | 技術的課題あり、または工数大 |
| 不明 | 調査・研究が必要、解決策が不明確 |

---

# A. 技術選択（確定事項）

## A-1. 言語・フレームワーク選択

| 選択肢 | 評価 | 決定理由 |
|--------|------|----------|
| Go | ✅ 採用 | SSE直接実装、軽量バイナリ、外部依存なし |
| TypeScript | ❌ 不採用 | 既存プロジェクト(dwhbi)と差別化、ランタイム依存 |
| Rust | ❌ 不採用 | 学習コスト、開発速度 |

## A-2. インフラ選択

| 選択肢 | 評価 | 決定理由 |
|--------|------|----------|
| Koyeb Free Tier | ✅ 採用 | $0/月、GitHub連携、自動デプロイ |
| Fly.io | ❌ 変更 | ~$2/月（開発ツールに課金不要と判断） |
| Cloudflare Workers | ❌ 不採用 | シングルテナントのため中間レイヤー不要 |

## A-3. 実装方針

| 項目 | 選択 | 理由 |
|------|------|------|
| SSE実装 | Go標準ライブラリ | 外部依存なし、MCP仕様完全準拠 |
| IaC | deploy.sh + CLI | 1サービスのみ、Terraformオーバーヘッド回避 |
| 遅延呼び出し | 採用 | コンテキスト消費 < 全ツール読み込み、UX影響軽微 |

## A-4. コスト制約（$0/月）

| コンポーネント | サービス | 月額 |
|---------------|----------|------|
| Go MCP Server | Koyeb Free Tier | $0 |
| 監視 | Grafana Cloud Free | $0 |
| CI/CD | GitHub Actions Free | $0 |
| ドメイン | Cloudflare | $0 |

---

# B. アーキテクチャ課題

## B-1. Token Broker（認証抽象化）【改善可能性: 易】

**問題:** モジュールレジストリとToken取得が密結合

```go
// 現状: 各モジュールが直接環境変数を参照
func getToken() string {
  return os.Getenv("GITHUB_TOKEN")
}
```

**課題:**
- モジュール追加ごとに認証パターンを再実装
- Bearer Token, Basic Auth, API Key等の認証方式が散在
- テスト時のモック化が困難

**解決策:** Token Broker インターフェース

```go
type TokenBroker interface {
  GetHeaders(moduleName string) map[string]string
}
```

---

## B-2. 外部APIバージョンチェック【改善可能性: 不明】

**現状:** CIで外部APIのバージョン互換性をチェックしている

**疑問:** 本当に必要か？
- 各外部APIは頻繁に変更されるわけではない
- 変更があっても後方互換性が維持されることが多い
- CIの複雑化とメンテナンスコストに見合うか不明

**暫定方針:** 現状維持しつつ、実際に問題が発生するか観察

---

## B-3. Tool Sieve（ツールマスク）【改善可能性: 易】

**目的:** ユーザーロールに応じたツールマスク

| 効果 | 説明 |
|------|------|
| コンテキスト節約 | ユーザーが使わないツールを自動除外 |
| ハルシネーション防止 | 権限外ツールへのLLM誤呼び出しを原理的に不可能にする |
| セキュリティ | 最小権限の原則をMCPレイヤーで実現 |

---

## B-3. エラーハンドリング標準化【改善可能性: 易】

**問題:** 各ハンドラーで同一の検証ロジック、エラー露出リスク

```go
// 現状: 重複コード
owner, ok := params["owner"].(string)
if !ok {
  return "", fmt.Errorf("owner must be a string")
}
```

**解決策:**
1. ValidatedParams ヘルパー導入
2. エラーラッピング、センシティブ情報のマスク

---

## B-4. モジュールCLI分離設計（COR-009補足）

**設計方針:** 各モジュールをCore関数 + CLIラッパーとして実装

```
【構造】
MCPサーバー → モジュールレジストリ → Core関数（Go関数として直接インポート）

CLI
├─ Core関数（ビジネスロジック）← MCPとCLI両方からインポート
└─ HTTPクライアント（Core関数にDI）← テスト時にモック可能
```

**ポイント:**
- MCPサーバーはCore関数をGo関数として直接呼び出し（別プロセス起動ではない）
- Core関数内部でHTTPクライアントをDI（テスタビリティ確保）
- `go run ./cmd/github-cli ...` で人間もスタンドアロン実行可能

**メリット:**
- **テスタビリティ**: HTTPクライアントをモックしてCore関数を単体テスト
- **比較検証**: 人間がCLI実行した結果とLLM経由の結果を比較可能
- **開発フロー**: CLIとして動作確認 → MCPラッパー追加の段階的開発
- **拡張性**: MCP以外のプロトコル対応時（A2A等）にCore関数を再利用

**注:**
- DIはCLI内部（Core関数へのHTTPクライアント注入）で行い、MCPサーバー→モジュール間では行わない
- 現時点ではモジュールごとのHTTPモックは実装しない
- ただしCore関数は、将来CLI分離（別プロセス化）が必要になった際に移行可能な抽象度・結合度で実装する

---

## B-5. モジュール自動発見【改善可能性: 難】

**問題:** main.goで手動登録が必須

```go
modules.Register(github.Module())
modules.Register(jira.Module())
```

**解決策:** プラグインアーキテクチャ / 自動発見パターン

**難易度が高い理由:** Goのプラグイン機構の制約、ビルド時vs実行時の選択

---

# C. 外部API連携課題

## C-1. Notionレスポンスの複雑さ【改善可能性: 易】

**問題:** レスポンスが複雑すぎてトークン消費が過大

**具体例:**
- 一文一文がブロック → 単純な文章でも長大なJSON
- 色情報等の不要データも含む

**対策:**
- レスポンスフィルタリング（必要フィールドのみ抽出）
- 要約レイヤーの導入（LLMに渡す前に圧縮）

---

## C-2. GitHub Issue一覧のUX【改善可能性: 易】

**問題:** repo/ownerを指定しないとLLMとの往復が増える

**対策:**
- デフォルト値の設定機能（ユーザー設定で事前指定）
- コンテキストからの自動推論（現在のディレクトリのgit remote等）

---

## C-3. Confluence vs Notion のデータ構造差異【改善可能性: 不明】

**問題:** 同じドキュメント管理アプリでもデータ構造が大きく異なる

| 観点 | Confluence | Notion |
|------|-----------|--------|
| 入力形式 | HTMLをそのまま入力 | JSON（ブロック構造） |
| 入力の問題 | レンダリングエラー発生あり | 単純な文章でも長大なJSON |
| レスポンス | 比較的軽量 | 長大なJSON |

**具体例:**

```
【Confluence】
入力: "<p>Hello World</p>"
→ シンプルだがHTML構文エラーでレンダリング失敗のリスク

【Notion】
入力:
{
  "children": [
    {
      "type": "paragraph",
      "paragraph": {
        "rich_text": [{"type": "text", "text": {"content": "Hello World"}}]
      }
    }
  ]
}
→ 単純な1文でも深いネスト構造が必要
```

**結論:** 標準化は困難であり、しないほうがよいか？LLMの挙動を研究する必要がある。

**理由:**
- 各サービスの特性を活かした操作が可能
- 抽象化レイヤーは逆に複雑性を増す
- Notionはレスポンスフィルタリングで別途対応（C-1）

---

# D. UX課題

## D-1. ツール実行確認時の理解困難【改善可能性: 易】

**問題:** 確認を求められても、何をしようとしているか理解できない

**具体例:**
```
[MCP] call_module_tool を実行しますか？
params: {"module":"github","tool_name":"create_issue","params":{...}}

→ ユーザー視点: 「何のIssueを作ろうとしてるの？」が分からない
```

**解決策:** MCP 2025-11-25で追加されたElicitation機能を活用

**トレードオフ:**
- 説明を増やす → コンテキスト消費増
- 説明を省く → ユーザーが盲目的に承認するリスク

**方針:** Elicitation機能の実装を検討し、コンテキスト消費とUXのバランスを観察

---

# E. 認証・セキュリティ課題

## E-1. OAuth実装の難航【改善可能性: 易（教訓として）】

**問題:** Claude MCP Server連携のOAuth実装に想定以上の時間を要した

**原因:** OAuth 2.0 / OIDC仕様の事前調査不足

**教訓:**
- 認証フローは事前に仕様書を精読すべき
- 特にリダイレクトURI、スコープ、トークンリフレッシュの理解が重要

---

## E-2. バックアップ構成の認証管理【改善可能性: 難】

**現状:** Vercel/Supabaseにもホスト済みだが、認証設定があいまい

| プラットフォーム | コールドスタート | 評価 | 認証状態 |
|-----------------|-----------------|------|---------|
| Koyeb (現行) | 数秒（ping維持で回避） | ✅ 安定 | 設定済み |
| Vercel Serverless | 体感上気にならない | ✅ バックアップ候補 | あいまい |
| Supabase Edge | 体感上気にならない | ✅ バックアップ候補 | あいまい |

**リスク:** 再認証が必要になった場合の復旧作業が不明確

---

# F. オブザーバビリティ

## F-1. メトリクス拡張【改善可能性: 易】

現在のLoki統合に加え、以下のメトリクス収集を検討：

| 対象 | メトリクス例 | 活用目的 |
|------|------------|----------|
| 開発者 | エラー率、レイテンシ分布 | バグ修正・パフォーマンス改善 |
| 管理者 | ツール利用頻度、モジュール別呼び出し数 | キャパシティプランニング |
| ユーザー | タスク完了率、コンテキスト消費量 | UX改善・バージョンアップ判断 |

---

# G. 改善優先度サマリー

| 優先度 | 項目 | 改善可能性 | 理由 |
|--------|------|-----------|------|
| 高 | B-1. Token Broker | 易 | マルチテナント化の前提条件 |
| 高 | B-3. エラーハンドリング標準化 | 易 | セキュリティ・保守性 |
| - | B-4. CLI分離設計 | - | COR-009の補足（設計方針として確定） |
| 中 | B-2. Tool Sieve | 易 | セキュリティ・UX向上 |
| 中 | C-1. Notionレスポンス軽量化 | 易 | トークン消費削減 |
| 中 | C-2. GitHub Issue デフォルト値 | 易 | UX向上 |
| 中 | F-1. メトリクス拡張 | 易 | 改善サイクル加速 |
| 低 | B-5. モジュール自動発見 | 難 | Phase 2以降で検討 |
| 低 | E-2. バックアップ認証整備 | 難 | 優先度低いが放置リスクあり |
| 要調査 | B-2. 外部APIバージョンチェック | 不明 | 必要性の検証が必要 |
| 要調査 | C-3. API標準化 | 不明 | LLM挙動の研究が必要 |
| 中 | D-1. ツール確認UX (Elicitation) | 易 | MCP 2025-11-25で仕様追加済み |

---

## 関連ドキュメント

- [concept-paper.md](./concept-paper.md) - コンセプト・仮説
- [go-mcp-dev-plan.md](../DAY1/go-mcp-dev-plan.md) - 実装計画
- [MCPist-Design-Philosophy.md](../DAY2/MCPist-Design-Philosophy.md) - 設計哲学
